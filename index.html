<!DOCTYPE html>
<html>

<head>
<meta charset='utf-8'>
<style>
	#container{
		margin: 10px auto 10px auto;
	}
		
	.casa {
		display: flex;
		justify-content: center; /* align horizontal */
		align-items: center;
		transition: background-color 610ms;
		float:left;
		border: #BBB solid 1px;
	}
	
	.casa0 { background-color: #CCC }
	.casa1 { background-color: #3695D6 } 
	.casa2 { background-color: #DC7538 }
	
	.jogador1 { color: #3695D6 } 
	.jogador2 { color: #DC7538 }
	
	.possivel {
		background-color: #CDC;
		display: flex;
		justify-content: center; /* align horizontal */
		align-items: center;
		transition: background-color 610ms;
		float:left;
		border: #BBB solid 1px;
	}
	
	.casa:hover {
		background-color: #E03535;
	}
	
	.possivel:hover {	
		background-color: #34A55E;
	}
	
	/*.casa-top-left { border-top-left-radius: 25px }
	.casa-top-right { border-top-right-radius: 25px }
	.casa-bottom-left { border-bottom-left-radius: 25px; }
	.casa-bottom-right { border-bottom-right-radius: 25px; }*/
	
</style>

<script src="jquery-2.1.4.js"></script>
<script src="hashtable.js"></script>
<script src="hashset.js"></script>
<script src="Casa.js"></script>
<script src="Tabuleiro.js"></script>
<script src="Jogador.js"></script>
<script src="Jogada.js"></script>
<script>
	window.onload = function(){
		var jogadores = [new Jogador(), new Jogador()];
		jogadores[0].oponente = jogadores[1];
		jogadores[1].oponente = jogadores[0];
		console.log(jogadores);
	
		var jogadorDaVez = jogadores[1].passarVez();
		
		var jogadas = new Array();
		
		// ---------------------------------------------------
		/*var  v = ["", ".", "..", "..."];
		var i = 0;
		setInterval(function () {
			i %= 4;
			document.getElementById("loading").innerHTML = v[i];
			i++ ;
		}, 500);*/
		// ---------------------------------------------------

		var t = new Tabuleiro("container", 455, 8);
		t.casas[3][3].tipo = Tipo.JOGADOR2;
		t.casas[4][4].tipo = Tipo.JOGADOR2;
		t.casas[3][4].tipo = Tipo.JOGADOR1;
		t.casas[4][3].tipo = Tipo.JOGADOR1;

		/*t.casas[4][3].tipo = Tipo.JOGADOR1;
		t.casas[4][4].tipo = Tipo.JOGADOR1;
		t.casas[4][5].tipo = Tipo.JOGADOR1;
		
		t.casas[3][3].tipo = Tipo.JOGADOR2;
		t.casas[3][4].tipo = Tipo.JOGADOR2;
		t.casas[3][5].tipo = Tipo.JOGADOR2;	*/

		t.mostrarPossiveis(jogadorDaVez.id);
		t.refresh();
		
		for (var i = 0; i < t.casas.length; i++)	
			for (var j = 0; j < t.casas[i].length; j++){
				t.casas[i][j].div.addEventListener("click", function(event){
					selecionarDiv(event.target);
				});	
			}
			
		document.forms[0].desfazer.addEventListener("click", function(){
			desfazerJogada(t, jogadorDaVez);
		});

		$("#container").bind('mousewheel', function(event) {
			if (event.originalEvent.wheelDelta >= 0) {
				t.dimensao += 5;
			}
			else {
				t.dimensao -= 5;
			}
			t.refresh();
		});

		function selecionarDiv(div){
			console.log(div);
			var x, y;
			var num = div.id.substring(div.id.length - 2, div.id.length);
			x = parseInt(num.charAt(0));
			y = parseInt(num.charAt(1));
			
			var casa = t.casas[x][y];
			if (t.jogadaValida(casa))
				selecionarCasa(casa);
		}
		
		function selecionarCasa(casa){
			//TODO deve ser feita uma cópia de jogadorDaVez em vez de passar o objeto inteiro
			// por enquanto funcionará, mas quando for necessário restaurar a quantidade de jogadas e pontos
			// será necessária a cópia
			jogadas.push(new Jogada(casa, t.obterTriplas(), jogadorDaVez)); 
			casa.tipo = jogadorDaVez.id;		
			
			var caminhos = t.todosCaminhos(casa, jogadorDaVez.id);
			
			for (var i = 0; i < caminhos.length; i++)
				for (var j = 0; j < caminhos[i].length; j++){
					x = caminhos[i][j].x;
					y = caminhos[i][j].y;
					t.casas[x][y].tipo = jogadorDaVez.id;
				}
					
			t.refresh();
			jogadorDaVez = jogadorDaVez.passarVez();
			t.mostrarPossiveis(jogadorDaVez.id);
			while (t.possiveisUltimaJogada.length == 0){
				if (t.fimDoJogo()) {
					window.alert("Fim do Jogo");	
					break;
				}
				jogadorDaVez = jogadorDaVez.passarVez();
				t.mostrarPossiveis(jogadorDaVez.id);
			}
		}
		
		function desfazerJogada(tabuleiro, jogador){
			if (jogadas.length == 0){
				window.alert("Não há mais jogadas a serem desfeitas");
			}
			else{
				var ultimaJogada = jogadas.pop();
				tabuleiro.restaurarTriplas(ultimaJogada.triplas, ultimaJogada.jogador);
				jogadorDaVez = ultimaJogada.jogador.oponente.passarVez();
			}
			//console.log(tabuleiro);
			//console.log(jogador);
		}		
		/*
		function trocarjogadorDaVez(){
			if (jogadorDaVez == Tipo.JOGADOR1)
				jogadorDaVez = Tipo.JOGADOR2;
			else
				jogadorDaVez = Tipo.JOGADOR1;
			$("#jogadorDaVez").text("Jogador " + jogadorDaVez);
		}*/
		
		//console.log(t.vizinhosVazios(1));
		
		/*
		console.log(t.existeCaminho(t.casas[4][3],t.casas[2][2]));
		console.log(t.existeCaminho(t.casas[2][2],t.casas[4][3]));
		console.log(t.existeCaminho(t.casas[2][2],t.casas[2][2]));
		
		console.log(t.existeCaminho(t.casas[3][4],t.casas[6][4]));
		
		console.log(t.existeCaminho(t.casas[3][7],t.casas[3][1]));
		
		console.log(t.existeCaminho(t.casas[7][7],t.casas[1][1]));
		
		console.log(t.existeCaminho(t.casas[5][3],t.casas[2][6]));
		*/
		
		/*
		console.log(t.caminho(t.casas[0][0], t.casas[7][7]));
		console.log(t.caminho(t.casas[7][7], t.casas[0][0]));
		console.log(t.caminho(t.casas[0][7], t.casas[1][6]));
		console.log(t.caminho(t.casas[0][7], t.casas[0][7]));
		*/
		
		//console.log(t.jogadasPossiveis(jogadorDaVez));
		//console.log(t.toString());
	};
	
	

</script>
</head>

<body>
	<p id="vez"></p>
	
	<div id="container">
	</div>
			
	<form>
		<input type="button" name="desfazer" value="Desfazer jogada" />
	</form>		
	<pre id="loading">
	</pre>
	
</body>
</html>
